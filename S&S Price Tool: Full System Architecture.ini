S&S Price Tool: Full System Architecture

This document describes the two main processes for the application:

One-Time Setup: How we generate the "translation brain" (the 4 JSON files).

Live App Flow: How the salesperson uses the live, deployed application.

Flow 1: One-Time Setup (Developer-Only)

This flow is performed only by you, on your local computer (e.g., your Mac) to create the data files. This entire process is what the sku_discovery_tool.py script automates.

(YOU)
 ┃
 ┗━[ 1. Run Scraper Locally ]
      (./venv/bin/python sku_discovery_tool.py)
           ┃
           ┣━━[ 2. Scrape HTML ]━━━━━━━━━━━━━━━━━━━┓
           ┃   (GET requests)                      ┃
           ┃                                       ┃
           ┣━━[ 3. Call Fabric API ]━━━━━━━━━━━━━━┓ ┃
           ┃   (POST requests)                   ┃ ┃
           ┃                                     ┃ ┃
           ▼                                     ▼ ▼
 [ sofasandstuff.com Server ]     [ sofasandstuff.com APIs ]
 (HTML pages)                   (/GetPDPFabrics)
           │
           │ 4. Scraper builds translation maps...
           │
           ▼
 [ 5. Four JSON "Brain" Files Created Locally ]
 (products.json, sizes.json, covers.json, fabrics.json)


Step-by-Step (Flow 1):

You (the developer) run the sku_discovery_tool.py script inside your venv on your local computer.

Scrape HTML: The script makes GET requests to the public S&S website (e.g., /sofas, /beds) to find all product names, their SKUs, and their product "type".

Call Fabric API: For each product it finds, the script also calls the internal GetPDPFabrics API to get the complete list of available fabrics for that product.

Build Brain: The script combines all this data into four clean JSON files.

Result: You now have the 4 "brain" files saved in your project folder, ready for deployment.

Flow 2: The Live Application (Salesperson Use)

This is the end-to-end flow of the final, deployed application. The 4 JSON files from Flow 1 are now bundled with your backend function.

[ 1. Salesperson ]
 (with Phone/Tablet)
     ┃
     ┗━[ 2. Opens index.html ]
         (Hosted on GitHub Pages)
              ┃
              ┃ 3. Sends query: {"query": "snape chair pacific"}
              ┃
              ▼
 [ 4. Your Backend Translator (main.py) ]
 (Hosted on Google Cloud Functions)
     ┃
     ┣━[ 5. Loads "Brain" ]
     ┃   (products.json, fabrics.json, etc.)
     ┃
     ┣━[ 6. Translates Query ]
     ┃   (Finds: "sna", "chr", "fit", "sxp", "pac")
     ┃
     ┣━[ 7. Smart API Routing ]
     ┃   (IF type is "bed" ━━▶ Call Bed API)
     ┃   (IF type is "chair" ━▶ Call Sofa API)
     ┃
     ┣━━[ 8. Call (Bed API) ]━━━━━━━━━━━━━━━━━━━┓
     ┃   (/Category/ProductPrice)              ┃
     ┃   (Payload: {productsku: "arl", ...})   ┃
     ┃                                         ┃
     ┣━━[ 9. Call (Sofa API) ]━━━━━━━━━━━━━━┓ ┃
     ┃   (/ProductExtend/ChangeProductSize)  ┃ ┃
     ┃   (Payload: {querySku: "snachr..."}) ┃ ┃
     ┃                                       ┃ ┃
     ▼                                       ▼ ▼
 [ S&S Internal APIs ]          [ 10. API returns complex JSON ]
     │
     │ 11. Backend simplifies JSON (pulls price, images, specs)
     │     Caches the result.
     │
     ▼
 [ 12. index.html (Frontend) ]
 (Receives simple JSON: {"productName": "Snape Chair", "price": "£1,409", ...})
     ┃
     ┗━[ 13. Displays Price & Images ]
         (Salesperson gets the answer)


Step-by-Step (Flow 2):

Salesperson opens the github.io URL.

Frontend (index.html) loads on their device.

Salesperson speaks/types. The JS sends the query {"query": "snape chair pacific"} to your Google Cloud Function URL.

Your Backend (main.py) receives the query.

Loads Brain: It reads the 4 JSON files that are deployed with it.

Translates: It uses the JSON files to find all the SKUs: product_sku: "sna", size_sku: "chr", etc.

Routes: It looks up "sna" in products.json and finds type: "chair". The if statement directs it to use the "Sofa API" route.

(Skipped)

Calls S&S API: The backend builds the combined querySku (snachrfitttpbis) and calls the ChangeProductSize API.

Gets Response: The S&S API returns a large, complex JSON.

Simplifies: Your backend pulls out only the data it needs (price, image URLs, specs), caches it, and sends this simple JSON back to the frontend.

Frontend receives the simple JSON.

Displays Result: The JavaScript in index.html updates the page to show the product name, price, and images to the salesperson.